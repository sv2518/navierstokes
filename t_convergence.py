from tests.taylorgreen import *
import matplotlib.pyplot as plt
from helpers.plot_convergence_velo_pres import plot_convergence_velo_pres
import math

#####################MAIN#############################
#plottin spatial convergence for taylor green vortices

error_velo=[]
error_pres=[]
list_dx=[]


RE=1
refin=[0.07,0.065,0.06,0.05,0.04,0.03,0.02,0.015,0.01]#,0.075]

cflList=[1,2,3,5]
peclet=10


RE=1
#refin=[0.07,0.065,0.06,0.05,0.04,0.03,0.02,0.015,0.01]#,0.075]
#cflList=[10]
#tmp=[0.018664174119308475, 0.004345185588971822, 0.000704615544113892, 0.00019933671154200445]
#tmp=[0.018664174119308548, 0.004345185588971723, 0.0007046155441139323]

D=2#space dimension
print("d is:",D)

cflList=[0.1]
u=1
dx=2*u*0.00025/(0.2/D**2)
print(dx)
refin=[0.001,0.0075,0.0005,0.00025,0.00001,0.00005]
#increasing spatial refinement (number of elements)
errorList=[]
for cfl in cflList:
    error_velo=[]
    error_pres=[]
    for dt in refin:
        #time stepping
        u=1
        print(u)
        nue=1
        print(dx)
        T=0.001/dt
        t=[dt,T]
        #solve
        w,err_u,err_p,dx = taylorgreen(dx, D,t,RE,True)
        u,p=w.split()
        error_velo.append(err_u)
        error_pres.append(err_p)
        list_dx.append(dx)

        print(error_velo)    
    errorList.append([error_velo,error_pres,list_dx])

#convergence plots
print(errorList)

for cc in range(0,len(cflList)):
    plot_convergence_velo_pres(errorList[cc][0],errorList[cc][1],refin,1,"hi")
plt.show()

#10,25,30,50
monster=[[[1.0967816804723771, 1.0355825409546904, 0.9731475342327075, 0.844092447781631, 0.4845921647183503, 0.35166971340011216, 0.13623004443161094, 0.091413014392757, 0.06048802676414459], [0.5000838400623255, 0.4872297073197828, 0.47366455443689415, 0.44290562590796906, 0.339805457891182, 0.2602685802714721, 0.2066932656483069, 0.20178512783958727, 0.14037432091074306], [0.08366600265340755, 0.0806225774829855, 0.07745966692414834, 0.07071067811865475, 0.06324555320336758, 0.054772255750516606, 0.04, 0.03, 0.02, 0.055999999999999994, 0.052000000000000005, 0.048, 0.04, 0.032, 0.024, 0.016, 0.012, 0.008, 0.04666666666666666, 0.043333333333333335, 0.04, 0.03333333333333333, 0.02666666666666667, 0.02, 0.013333333333333334, 0.01, 0.006666666666666667, 0.027999999999999997, 0.026000000000000002, 0.024, 0.02, 0.016, 0.012, 0.008, 0.006, 0.004]], [[1.106299252800629, 1.0453838056453322, 0.9826543023248677, 0.8531876113358015, 0.4974625790084132, 0.363436786244524, 0.14422640310855045, 0.09619830215672119, 0.06298249049102746], [0.5052207661663105, 0.49279731551067635, 0.47938335045428226, 0.44917710758933477, 0.3473992144323354, 0.26820991036088493, 0.21386987415554531, 0.20823025236299808, 0.1443123023695548], [0.08366600265340755, 0.0806225774829855, 0.07745966692414834, 0.07071067811865475, 0.06324555320336758, 0.054772255750516606, 0.04, 0.03, 0.02, 0.055999999999999994, 0.052000000000000005, 0.048, 0.04, 0.032, 0.024, 0.016, 0.012, 0.008, 0.04666666666666666, 0.043333333333333335, 0.04, 0.03333333333333333, 0.02666666666666667, 0.02, 0.013333333333333334, 0.01, 0.006666666666666667, 0.027999999999999997, 0.026000000000000002, 0.024, 0.02, 0.016, 0.012, 0.008, 0.006, 0.004]], [[1.109307725034047, 1.0481729480501496, 0.985161103621365, 0.8551690367249528, 0.49954213766495636, 0.36502078089605644, 0.14511337069516478, 0.0967418213163029, 0.06326791183863635], [0.5068591254280314, 0.4943983405002761, 0.4809088934155652, 0.45056334861795827, 0.34864672237641037, 0.26929242671272763, 0.21466429976507634, 0.20895739084875364, 0.14476014414079152], [0.08366600265340755, 0.0806225774829855, 0.07745966692414834, 0.07071067811865475, 0.06324555320336758, 0.054772255750516606, 0.04, 0.03, 0.02, 0.055999999999999994, 0.052000000000000005, 0.048, 0.04, 0.032, 0.024, 0.016, 0.012, 0.008, 0.04666666666666666, 0.043333333333333335, 0.04, 0.03333333333333333, 0.02666666666666667, 0.02, 0.013333333333333334, 0.01, 0.006666666666666667, 0.027999999999999997, 0.026000000000000002, 0.024, 0.02, 0.016, 0.012, 0.008, 0.006, 0.004]], [[1.1154087492907165, 1.0537069124298468, 0.9901380923085537, 0.8590217197247941, 0.5038553660445716, 0.36806177347459157, 0.14690412994705876, 0.09781612497485215, 0.0638377880817749], [0.5102028913504222, 0.4975973140983536, 0.4839604842569428, 0.45327978740035424, 0.3512525260879433, 0.27137981204257944, 0.21626755356870347, 0.21039215621552146, 0.14565298908505878], [0.08366600265340755, 0.0806225774829855, 0.07745966692414834, 0.07071067811865475, 0.06324555320336758, 0.054772255750516606, 0.04, 0.03, 0.02, 0.055999999999999994, 0.052000000000000005, 0.048, 0.04, 0.032, 0.024, 0.016, 0.012, 0.008, 0.04666666666666666, 0.043333333333333335, 0.04, 0.03333333333333333, 0.02666666666666667, 0.02, 0.013333333333333334, 0.01, 0.006666666666666667, 0.027999999999999997, 0.026000000000000002, 0.024, 0.02, 0.016, 0.012, 0.008, 0.006, 0.004]]]
for cc in range(0,len(cflList)):
        plot_convergence_velo_pres(monster[cc][0],monster[cc][1],refin,1,"hi")
plt.show()

#1,2,3,5
monster=[[[1.0846916551828996, 1.024491381082698, 0.962360976327584, 0.8351911601092783, 0.47422306026835975, 0.3428080404200763, 0.12854229446494614, 0.08509862536224028, 0.05564853194674173], [0.4936530096840632, 0.48103797223815503, 0.4673007193293223, 0.4369104733771959, 0.3338394732711285, 0.2543944432390903, 0.19975464913965857, 0.19312387798701194, 0.13253626938619592], [0.11832159566199232, 0.1140175425099138, 0.10954451150103321, 0.1, 0.08944271909999159, 0.07745966692414834, 0.06324555320336758, 0.054772255750516606, 0.044721359549995794, 0.11832159566199232, 0.1140175425099138, 0.10954451150103321, 0.1, 0.08944271909999159, 0.07745966692414834, 0.06324555320336758, 0.054772255750516606, 0.044721359549995794, 0.11832159566199232, 0.1140175425099138, 0.10954451150103321, 0.1, 0.08944271909999159, 0.07745966692414834, 0.06324555320336758, 0.054772255750516606, 0.044721359549995794, 0.11832159566199232, 0.1140175425099138, 0.10954451150103321, 0.1, 0.08944271909999159, 0.07745966692414834, 0.06324555320336758, 0.054772255750516606, 0.04]], [[1.0846916551828998, 1.0244913810826983, 0.962360976327584, 0.8351911601092783, 0.47422306026835975, 0.3428080404200763, 0.12854229446494614, 0.08509862536224028, 0.055648531946741735], [0.49365300968406317, 0.48103797223815514, 0.4673007193293225, 0.43691047337719585, 0.3338394732711285, 0.2543944432390903, 0.19975464913965857, 0.19312387798701194, 0.13253626938619592], [0.11832159566199232, 0.1140175425099138, 0.10954451150103321, 0.1, 0.08944271909999159, 0.07745966692414834, 0.06324555320336758, 0.054772255750516606, 0.044721359549995794, 0.11832159566199232, 0.1140175425099138, 0.10954451150103321, 0.1, 0.08944271909999159, 0.07745966692414834, 0.06324555320336758, 0.054772255750516606, 0.044721359549995794, 0.11832159566199232, 0.1140175425099138, 0.10954451150103321, 0.1, 0.08944271909999159, 0.07745966692414834, 0.06324555320336758, 0.054772255750516606, 0.044721359549995794, 0.11832159566199232, 0.1140175425099138, 0.10954451150103321, 0.1, 0.08944271909999159, 0.07745966692414834, 0.06324555320336758, 0.054772255750516606, 0.04]], [[1.0846916551828998, 1.0244913810826979, 0.9623609763275841, 0.835191160109278, 0.47422306026835975, 0.3428080404200763, 0.1285422944649461, 0.08509862536224028, 0.05564853194674177], [0.4936530096840632, 0.48103797223815514, 0.46730071932932243, 0.4369104733771959, 0.3338394732711285, 0.2543944432390903, 0.1997546491396585, 0.19312387798701194, 0.1325362693861959], [0.11832159566199232, 0.1140175425099138, 0.10954451150103321, 0.1, 0.08944271909999159, 0.07745966692414834, 0.06324555320336758, 0.054772255750516606, 0.044721359549995794, 0.11832159566199232, 0.1140175425099138, 0.10954451150103321, 0.1, 0.08944271909999159, 0.07745966692414834, 0.06324555320336758, 0.054772255750516606, 0.044721359549995794, 0.11832159566199232, 0.1140175425099138, 0.10954451150103321, 0.1, 0.08944271909999159, 0.07745966692414834, 0.06324555320336758, 0.054772255750516606, 0.044721359549995794, 0.11832159566199232, 0.1140175425099138, 0.10954451150103321, 0.1, 0.08944271909999159, 0.07745966692414834, 0.06324555320336758, 0.054772255750516606, 0.04]], [[1.084691655182901, 1.0244913810826983, 0.962360976327584, 0.8351911601092784, 0.47422306026835975, 0.3428080404200763, 0.12854229446494614, 0.08509862536224028, 0.05650795416999576], [0.4936530096840633, 0.48103797223815514, 0.46730071932932227, 0.43691047337719585, 0.3338394732711285, 0.2543944432390903, 0.19975464913965857, 0.19312387798701194, 0.13395461387310414], [0.11832159566199232, 0.1140175425099138, 0.10954451150103321, 0.1, 0.08944271909999159, 0.07745966692414834, 0.06324555320336758, 0.054772255750516606, 0.044721359549995794, 0.11832159566199232, 0.1140175425099138, 0.10954451150103321, 0.1, 0.08944271909999159, 0.07745966692414834, 0.06324555320336758, 0.054772255750516606, 0.044721359549995794, 0.11832159566199232, 0.1140175425099138, 0.10954451150103321, 0.1, 0.08944271909999159, 0.07745966692414834, 0.06324555320336758, 0.054772255750516606, 0.044721359549995794, 0.11832159566199232, 0.1140175425099138, 0.10954451150103321, 0.1, 0.08944271909999159, 0.07745966692414834, 0.06324555320336758, 0.054772255750516606, 0.04]]]
for cc in range(0,len(cflList)):
        plot_convergence_velo_pres(monster[cc][0],monster[cc][1],refin,1,"hi")
plt.show()


#plot actual errors in L2
#plt.plot(refin,np.array([3.9,1.2,0.33,0.093,0.026]),label="paper")
#plt.plot(refin,np.array(error_pres)/100,label="mine/100")
#plt.legend()
#plt.title("L2 error pressure")
#plt.show()

#plt.plot(refin,np.array([0.23,0.062,0.016,0.0042,0.0011]),label="paper")
#plt.plot(refin,error_velo,label="mine")
#plt.legend()
#plt.title("L2 error velocity")
#plt.show()
